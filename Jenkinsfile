podTemplate(label: 'jnlp-slave', 
    name:"jnlp-slave",
    containers: [
        containerTemplate(
            name: 'jnlp',
            image: 'dengyc/jnlp-slave'
        )        
    ]
    ,volumes: [
        hostPathVolume(hostPath: '/usr/bin/docker', mountPath: '/bin/docker'),
        hostPathVolume(hostPath: '/var/run/docker.sock', mountPath: '/var/run/docker.sock'),
    ]
){
    node ('jnlp-slave') {        
        stage('获取代码') {
            git url: 'https://github.com/deng-yc/node-docker.git' , branch: 'master'
        }        
        stage('编译程序') {     
            sh("chmod +x ./build.sh && ./build.sh")
        }

        stage("发布到k8s"){
            kubernetesDeploy(
                credentialsType: 'Text',
                textCredentials: [
                    serverUrl: 'https://192.168.31.240:6443',
                    certificateAuthorityData: 'LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN5RENDQWJDZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRFNE1ERXlPVEEyTVRrek1Wb1hEVEk0TURFeU56QTJN VGt6TVZvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTUEyCmNwcDlRZUlFWDRpdkI3N29jODJNNzRyMkdpeGx3cUtwVjc2RGs1NjBTNWE1TGYxV1RMd0R1eCtzVU45OWFldUoKaHZPcmFaS09tY1JQ V0ZDSzk0VFRvUE1rQk1VbUgyckI3Z0xhUzV2dXdRcXA5WTNMVElJRUNZVWhwZmZ2NkRmUQpodXhqOWpHRGFaem00czBpMjYrNldzL0dVYUM4R1BKWjROUW9oM3dFdWRvMzRNZzRObjJ0c0NWRWpvRCtRSjJiCkdBaitwd3djalBuSTVIZkpFcVBKbDJiWnVXOU9Ka2Q2ZXJ6TU5ELzVqUkJj STlmN0pFZkhoZEVRNldWNURDQkcKNDZ4ekE2UlcvTzUrZmJjdUR2UHQ5QUNNK0MyTm9GaHpNckRnSk5TeUhMc3M0YTkwWVBGTDlQTlFzdkZkajBoVgozTzhFUEJYbjZoWXUvU2U3Q3Q4Q0F3RUFBYU1qTUNFd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4 d0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFMdENacnpRQm1oZFE0N1RuVHNOQ0drUnliWFUKY3NQbkxzTHd2b1A1SFVmS2hIeWtBNVdKckZNc2ZiSElqd1BsMVFCTkliWTJlNWJSTDF6SWc3TjV3VUMxUjVtawpLcDJOZGtrTVl2a1p2K09KRUdlTWxDZmQ4amp0ajd0a2ExNE83a2NTMWtQ UUFXWGluaFpnMUdNbmUvUGxjVmNpCkxiSEZyVmpLeWxVc29Va28yNmM5Y3BkeFpFZmh3QzdzRlYxUjgzVzFWMUZuc0Q1MSt3K0l1NFNSQW5zdTRxVngKa0VwMTBLRWRBZWF1YVo3dVA2V2FSeGdqdit1TDdacERvU05hcFV0TmZNVHgrcDZieTY3UnFicVZWcXFNajd4QgpMdlhvZDNoU3Rk ZExvUXczU2RVVCsyTGROZGQ1VktoSjNyeWxIYUpnTHFIcFdjVFNZWnlaU3VNbG5pMD0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=',
                    clientCertificateData: 'LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM4akNDQWRxZ0F3SUJBZ0lJZFdLaGhDYmNkR1l3RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB4T0RBeE1qa3dOakU1TXpGYUZ3MHhPVEF 4TWprd05qRTVNekphTURReApGekFWQmdOVkJBb1REbk41YzNSbGJUcHRZWE4wWlhKek1Sa3dGd1lEVlFRREV4QnJkV0psY201bGRHVnpMV0ZrCmJXbHVNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXFxQVREYUpIQk1XbDZGTkcKQ3B6dGdEdTNCb1VvU24 vbXRVcnBxUEIvQzB0aURKNkJEQkQrdW5sZkpOZGg4bWFBclc1MEk0V0l1NDhnb053RQpkUDVZQURaeVdsNXNiNHREUDQvdUFTZ09jeGFLZXhqNGI2Q3ZCZXRqaGluWC81cFd3ZmJ2MWRNSHZpbDlkcHo0CmhUeHpGQ3F1VjdGUGFDakN5R2kxSjNmZUNkYVAxWFhhcU9GSEowdVkwd1R5S04 vVWdwVTdxa1ZaQ0hndU9SMDMKdklCN0tCMUdVTytwazM1WFEyQ0thTWhsMmJMdW9jMUpRdFZUSzlaWlNVNnN6cDcyRWtmQjJPWE9WUDZQQjNjRgo5RFYvQWtuajVPUlhTd0NXM0JBcFFDajFZTTRCWnZDNVZCOFd1dFlNWE1zcnc4VzVoWS8wcUk2VENMYjhuQ0JKCjNHR3dqUUlEQVFBQm9 5Y3dKVEFPQmdOVkhROEJBZjhFQkFNQ0JhQXdFd1lEVlIwbEJBd3dDZ1lJS3dZQkJRVUgKQXdJd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFHNHN1ZDVnU0VFSTF2aHBINk1GV1BmVjRQckFUbXFrR2pYYwp1TWNlQk5aOFBXWG9sa2JRRVhsdkg1aXVmZlZjcGF6cnM3MWpoTEJ6Z3BhU3R WZXpJOFBIbThIK0t4MkQ1eHpqCmhaY096NlEvMTR3dlp4NldBUElTSzBkSzdxR0lnMEpwS3QvbXRKb2c2MTVkOE5Mei9uaXZYeUxWY0JaaWt3UDIKS1N4cUgxSm42WEU5dzZmcm9Ha016RU5iQW9PTWhMVE1saWVBS2JRb3pKYkJCZ3AzU25YSk51OEZUQ2YzaytDeApveFBQQkVZSkRVYyt 1ZHl3UUExNDRjL2JFd3pGc3psc2JIRFN6NGlNUzlKYkorQWttUk5OZmMzMi9pWkpSd2xwCncxUVl3TzFWU1pHc3NnclNGV0cwWnkvVWVnMzlYTzlWY2VTYmxPc043RTVQUGhSeU91QT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=',
                    clientKeyData: 'LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb2dJQkFBS0NBUUVBcXFBVERhSkhCTVdsNkZOR0NwenRnRHUzQm9Vb1NuL210VXJwcVBCL0MwdGlESjZCCkRCRCt1bmxmSk5kaDhtYUFyVzUwSTRXSXU0OGdvTndFZFA1WUFEWnlXbDVzYjR0RFA 0L3VBU2dPY3hhS2V4ajQKYjZDdkJldGpoaW5YLzVwV3dmYnYxZE1IdmlsOWRwejRoVHh6RkNxdVY3RlBhQ2pDeUdpMUozZmVDZGFQMVhYYQpxT0ZISjB1WTB3VHlLTi9VZ3BVN3FrVlpDSGd1T1IwM3ZJQjdLQjFHVU8rcGszNVhRMkNLYU1obDJiTHVvYzFKClF0VlRLOVpaU1U2c3pwNzJ Fa2ZCMk9YT1ZQNlBCM2NGOURWL0Frbmo1T1JYU3dDVzNCQXBRQ2oxWU00Qlp2QzUKVkI4V3V0WU1YTXNydzhXNWhZLzBxSTZUQ0xiOG5DQkozR0d3alFJREFRQUJBb0lCQUZZSS9WS0VuemJpeXJPSgpPZW9rRXdYMEZtZnRRTkhBQ0g4bDFRaGdyRTd2cGZNakFZTXFGcWZFaDVzMkY2ZDQ xQzJmWW1SKzh1RlFYRzJBClE2Y1NrU0VhVXpNS0piZGhDM25EZzRtRnZ6TjlERHJoN25PckhGWHB5WGRmSmhFMnE4U0dWWTBHS2dOVFBIWlEKMUdlcWdZU0x1UGx5Nk0xbXNFRUp1ejY1akhaOHJhWkJXejh0bVVYbDhTRDVSV3ZRUVo3c1VsOXRXbTdYckFhbwo4emRKMDJYSVF2VVZBM1g zNVJyZTZybXIxMjErTTI2bzJqRTFTbXd6VUJLVkFBRmlhRDE1TElmU24vMFYxbUxaCllTUjhwNGVzbS9xeUhZTE1VQkV0Ylp5UmVNb2NqK2Y5NW4rejMyalhlR2tVR3dvcVZDazQ5MHZYL2o5NVhLLzUKaStqd1Rla0NnWUVBenZDd1ZRaWN3bWpNUUlpMjZTMXU5bGdhOWRheEU3eEVTQzh VdWMvSnJXSjNjRmlMWjJwQQpyelFkZGNFYnpObVo5Y3FIb0ZDN0RlVnQwbzUvb0VlenhZd3RBRElKcjZaVmVSZ3ZLS1NtaTV0c2tXTFN0ZWFPClBlSEJXNEVqVDhUeUxRTkhyVUZlK1lFZHZGMW9iOFlwUzVBUDdBa0hmcGlhdHMzOXNHME51Y01DZ1lFQTB4TnEKTlBKc1pUdndlSXB0OXR pcERVWFBCeWd4RFJIdVA1THBRZ0pkc2U3azczSmZZNmFLemxxUGYzNTArNWROVVUxcwpldTNzWWEyOG80Q0hlc3FyT0RXbXFjaTBUWWw2TU5kNERLejBnc3JJQ1c0c3BrdjMzVVFEdXpkR1RuWDNiR3hhCmpaSktYcm9INExBS0NHY2Nqd2FVcnIwZ042aXVNSkdWbzgvUjkyOENnWUIrY2t sOG0vZVZQdzNYUFBKdkJvanYKMDZRZHBXS3NDWFM3bXJFU1hLb0IzTkhZZnZJbmJhQTZyaUIyTEZuOVVOVW5mK3BoaGhMV0NlT1NMZXBFR0t2NwpRSXphdXJoNmNLdDNnOVNGQkI2VDNaTjRQcWM3NkxYdmovdGpHMFJsWUpVTjlod2MvSDI0L1RFYlFRUW9rQy81CmNQeVpvR2JJN3h4U0t Rb2pmRzlQbXdLQmdDZFZwZVFxRFNNc2NWcTFTVnJIODNFQ3dscnVGWDMvQ213VWY1MksKZlZWc1ZJTit4K0gxSmtiZ1AzK2QzRVVLWkNFemtYU3pJK3JzQ294WnBtV3VvUXUvaThoMkc0dWJoQWJZRUlvawpMUWkycTJKK2dwbVc3S0R5VE5PMXNFZHMybWY5SlQ3ZXRUZEQ2YlhvZUdZcWV QcjZXZmphUzhlemlvcUlodDlaCkdpTEhBb0dBQTJjUUtVd1ZaMlF3NmZidzcxemdIVWVnMjRJRFhFRHkwZ0ppejBIK3ZpSkp5VGx0cmxCbGVGeW8KK0twZEFYbzdPY2V4NWM2MDhnZFcwZ05TY3hGUWZSUlFTZGovSGo4WG9hMmNqYTR1VGlPRnczVUh0TWFBbjl1VwpjcHMyQ2NhVjIzMEw rUGY5ZWNKM2p1azdNaWJ6R0JUWGFZbDc1NjlDYThwUE5wUzVUSWM9Ci0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==',
                ],
                configs:"./deploy/*.yaml",
                enableConfigSubstitution:true
            )
        }
    }
}
